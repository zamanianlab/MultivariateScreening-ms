panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
d <- d_corrected +
inset_element(d_inset,
left = 0.6, bottom = 0.15, right = 0.9, top = 0.65, align_to = 'full',
ignore_tag = TRUE)
### E
e_z_factor <- read_rds(here('Fig2/subplots/primary_screen_z_factor.rds')) +
scale_color_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
scale_fill_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
theme(legend.position = 'empty')
### F
f_design <- image_read_pdf((here('Fig2/subplots/Fig2f.pdf')))
f <- ggdraw() + draw_image(f_design)
### G
g_screen <- read_rds(here('Fig2/subplots/primary_screen.rds'))
### H
h_hit_bar <- read_rds(here('Fig2/subplots/hit_bar.rds'))
### I
i_ec <- read_rds(here('Fig2/subplots/ec50_bar.rds'))
# set layout
abc_layout <- c(
area(t = 1, l = 1, b = 8, r = 12),   # a
area(t = 1, l = 13, b = 3, r = 20),  # b
area(t = 4, l = 13, b = 8, r = 20)   # c
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20)   # e
)
de_patch <-
d + e_z_factor +
plot_layout(design = de_layout)
# abc_patch / de_patch / f
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
a <- a_hundred_drift +
inset_element(a_inset,
left = 0.7, bottom = 0.5, right = 1, top = 1, align_to = 'full',
ignore_tag = TRUE)
a_hundred_drift <- read_rds(here('Fig2/subplots/uncorrected_drift_hundred.rds')) +
geom_vline(data = tibble(xintercept = c(1, 17, 33, 49, 65, 81)),
aes(xintercept = xintercept),
linetype = 'dashed',
color = 'grey') +
theme(
axis.title.x = element_blank(),
panel.grid.major.x = element_blank())
a_inset <- read_rds(here('Fig2/subplots/hundred_screen.rds')) +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
a <- a_hundred_drift +
inset_element(a_inset,
left = 0.7, bottom = 0.5, right = 1, top = 1, align_to = 'full',
ignore_tag = TRUE)
### B
b_frames <- read_rds(here('Fig2/subplots/frame_optimization.rds'))
### C
c_celltox <- image_read_pdf((here('Fig2/subplots/Fig2c.pdf')))
c_celltox <- ggdraw() + draw_image(c_celltox)  #+ theme(plot.margin = margin(-1, -1, -1, -1, "cm"))
### D
d_corrected <- read_rds(here('Fig2/subplots/corrected_drift.rds')) +
geom_vline(data = tibble(xintercept = c(1, 17, 33, 49, 65, 81)),
aes(xintercept = xintercept),
linetype = 'dashed',
color = 'grey') +
theme(
panel.grid.major.x = element_blank())
d_inset <- read_rds(here('Fig2/subplots/corrected_dist.rds')) +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
d <- d_corrected +
inset_element(d_inset,
left = 0.6, bottom = 0.15, right = 0.9, top = 0.65, align_to = 'full',
ignore_tag = TRUE)
### E
e_z_factor <- read_rds(here('Fig2/subplots/primary_screen_z_factor.rds')) +
scale_color_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
scale_fill_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
theme(legend.position = 'empty')
### F
f_design <- image_read_pdf((here('Fig2/subplots/Fig2f.pdf')))
f <- ggdraw() + draw_image(f_design)
### G
g_screen <- read_rds(here('Fig2/subplots/primary_screen.rds'))
### H
h_hit_bar <- read_rds(here('Fig2/subplots/hit_bar.rds'))
### I
i_ec <- read_rds(here('Fig2/subplots/ec50_bar.rds'))
abc_layout <- c(
area(t = 1, l = 1, b = 8, r = 12),   # a
area(t = 1, l = 13, b = 3, r = 20),  # b
area(t = 4, l = 13, b = 8, r = 20)   # c
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20)   # e
)
de_patch <-
d + e_z_factor +
plot_layout(design = de_layout)
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
fig2
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
fig2
ghi_patch
de_patch
abc_patch
fig2 <- abc_patch / de_patch / f / ghi_patch
fig2
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
# plot the data and correlation coefficients
(cor_plot <- frame_data %>%
filter(plate == 172) %>%
mutate(
col = str_pad(col, 2, pad = "0"),
n_frames = factor(n_frames, levels = c("5", "10", "20", "40"))
) %>%
left_join(record_order) %>%
ggplot() +
# geom_line(aes(x = well_number, y = log10(optical_flow), color = n_frames)) +
geom_point(aes(x = well_number, y = log10(optical_flow), color = n_frames, fill = n_frames),
size = 1) +
geom_richtext(
data = label,
aes(label = n_frames, x = x, y = log10(y), color = n_frames),
fill = NA, label.color = NA, size = 2.5, label.padding = unit(c(0, 0, 0, 0), "lines"),
hjust = 0.7, show.legend = FALSE
) +
scale_color_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_fill_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_x_continuous(limits = c(-1, 96), breaks = seq(1, 96, 8)) +
labs(x = "Well number", y = "log<sub>10</sub>Motility", color = "Number of frames") +
theme_nw2() +
theme(
panel.grid.major.y = element_blank(),
axis.title.x = element_blank(),
legend.position = "empty",
axis.text.x = element_markdown(angle = 0, hjust = 0.5)
) +
NULL)
conflict_prefer("filter", "dplyr")
# plot the data and correlation coefficients
(cor_plot <- frame_data %>%
filter(plate == 172) %>%
mutate(
col = str_pad(col, 2, pad = "0"),
n_frames = factor(n_frames, levels = c("5", "10", "20", "40"))
) %>%
left_join(record_order) %>%
ggplot() +
# geom_line(aes(x = well_number, y = log10(optical_flow), color = n_frames)) +
geom_point(aes(x = well_number, y = log10(optical_flow), color = n_frames, fill = n_frames),
size = 1) +
geom_richtext(
data = label,
aes(label = n_frames, x = x, y = log10(y), color = n_frames),
fill = NA, label.color = NA, size = 2.5, label.padding = unit(c(0, 0, 0, 0), "lines"),
hjust = 0.7, show.legend = FALSE
) +
scale_color_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_fill_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_x_continuous(limits = c(-1, 96), breaks = seq(1, 96, 8)) +
labs(x = "Well number", y = "log<sub>10</sub>Motility", color = "Number of frames") +
theme_nw2() +
theme(
panel.grid.major.y = element_blank(),
axis.title.x = element_blank(),
legend.position = "empty",
axis.text.x = element_markdown(angle = 0, hjust = 0.5)
) +
NULL)
save_plot(here("Fig2/subplots/Fig2b.pdf"), cor_plot, base_width = 4, base_height = 1)
write_rds(cor_plot, here("Fig2/subplots/frame_optimization.rds"))
### B
b_frames <- read_rds(here('Fig2/subplots/frame_optimization.rds'))
abc_layout <- c(
area(t = 1, l = 1, b = 8, r = 12),   # a
area(t = 1, l = 13, b = 3, r = 20),  # b
area(t = 4, l = 13, b = 8, r = 20)   # c
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20)   # e
)
de_patch <-
d + e_z_factor +
plot_layout(design = de_layout)
# abc_patch / de_patch / f
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
label <- tibble(
n_frames = c("40", "20", "10", "5"),
x = -2,
y = c(104514356, 49801758, 23594987, 10426864)
)
# plot the data and correlation coefficients
(cor_plot <- frame_data %>%
filter(plate == 172) %>%
mutate(
col = str_pad(col, 2, pad = "0"),
n_frames = factor(n_frames, levels = c("5", "10", "20", "40"))
) %>%
left_join(record_order) %>%
ggplot() +
# geom_line(aes(x = well_number, y = log10(optical_flow), color = n_frames)) +
geom_point(aes(x = well_number, y = log10(optical_flow), color = n_frames, fill = n_frames),
size = 1) +
geom_richtext(
data = label,
aes(label = n_frames, x = x, y = log10(y), color = n_frames),
fill = NA, label.color = NA, size = 2.5, label.padding = unit(c(0, 0, 0, 0), "lines"),
hjust = 0.7, show.legend = FALSE
) +
scale_color_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_fill_manual(values = wes_palette("Moonrise2"), guide = "none") +
scale_x_continuous(limits = c(-2, 96), breaks = seq(1, 96, 8)) +
labs(x = "Well number", y = "log<sub>10</sub>Motility", color = "Number of frames") +
theme_nw2() +
theme(
panel.grid.major.y = element_blank(),
axis.title.x = element_blank(),
legend.position = "empty",
axis.text.x = element_markdown(angle = 0, hjust = 0.5)
) +
NULL)
save_plot(here("Fig2/subplots/Fig2b.pdf"), cor_plot, base_width = 4, base_height = 1)
write_rds(cor_plot, here("Fig2/subplots/frame_optimization.rds"))
a_hundred_drift <- read_rds(here('Fig2/subplots/uncorrected_drift_hundred.rds')) +
geom_vline(data = tibble(xintercept = c(1, 17, 33, 49, 65, 81)),
aes(xintercept = xintercept),
linetype = 'dashed',
color = 'grey') +
theme(
axis.title.x = element_blank(),
panel.grid.major.x = element_blank())
a_inset <- read_rds(here('Fig2/subplots/hundred_screen.rds')) +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
a <- a_hundred_drift +
inset_element(a_inset,
left = 0.7, bottom = 0.5, right = 1, top = 1, align_to = 'full',
ignore_tag = TRUE)
### B
b_frames <- read_rds(here('Fig2/subplots/frame_optimization.rds'))
### C
c_celltox <- image_read_pdf((here('Fig2/subplots/Fig2c.pdf')))
c_celltox <- ggdraw() + draw_image(c_celltox)  #+ theme(plot.margin = margin(-1, -1, -1, -1, "cm"))
### D
d_corrected <- read_rds(here('Fig2/subplots/corrected_drift.rds')) +
geom_vline(data = tibble(xintercept = c(1, 17, 33, 49, 65, 81)),
aes(xintercept = xintercept),
linetype = 'dashed',
color = 'grey') +
theme(
panel.grid.major.x = element_blank())
d_inset <- read_rds(here('Fig2/subplots/corrected_dist.rds')) +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
d <- d_corrected +
inset_element(d_inset,
left = 0.6, bottom = 0.15, right = 0.9, top = 0.65, align_to = 'full',
ignore_tag = TRUE)
### E
e_z_factor <- read_rds(here('Fig2/subplots/primary_screen_z_factor.rds')) +
scale_color_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
scale_fill_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
theme(legend.position = 'empty')
### F
f_design <- image_read_pdf((here('Fig2/subplots/Fig2f.pdf')))
f <- ggdraw() + draw_image(f_design)
### G
g_screen <- read_rds(here('Fig2/subplots/primary_screen.rds'))
### H
h_hit_bar <- read_rds(here('Fig2/subplots/hit_bar.rds'))
### I
i_ec <- read_rds(here('Fig2/subplots/ec50_bar.rds'))
# set layout
abc_layout <- c(
area(t = 1, l = 1, b = 8, r = 12),   # a
area(t = 1, l = 13, b = 3, r = 20),  # b
area(t = 4, l = 13, b = 8, r = 20)   # c
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20)   # e
)
de_patch <-
d + e_z_factor +
plot_layout(design = de_layout)
# abc_patch / de_patch / f
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
de_patch <-
d + e_z_factor + get_legend(a_hundred_drift + theme(legend.position = 'bottom')) +
plot_layout(design = de_layout)
de_patch
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20),  # e
area(t = 5, l = 13, b = 6, r = 20)
)
de_patch <-
d + e_z_factor + get_legend(a_hundred_drift + theme(legend.position = 'bottom')) +
plot_layout(design = de_layout)
de_patch
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20),  # e
area(t = 5, l = 1, b = 6, r = 20)
)
de_patch <-
d + e_z_factor + get_legend(a_hundred_drift + theme(legend.position = 'bottom')) +
plot_layout(design = de_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20),  # e
area(t = 5, l = 1, b = 6, r = 20)
)
de_patch <-
d + e_z_factor + get_legend(a_hundred_drift + theme(legend.position = 'bottom',
legend.title = element_blank())) +
plot_layout(design = de_layout)
de_patch
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.7, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20),  # e
area(t = 5, l = 1, b = 5.1, r = 20)
)
de_patch <-
d + e_z_factor + get_legend(a_hundred_drift + theme(legend.position = 'bottom',
legend.title = element_blank())) +
plot_layout(design = de_layout)
de_patch
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.7, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
