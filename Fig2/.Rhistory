aes(xintercept = xintercept),
linetype = 'dashed',
color = 'grey') +
theme(
panel.grid.major.x = element_blank())
d_inset <- read_rds(here('Fig2/subplots/corrected_dist.rds')) +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black'),
plot.background = element_rect(fill = NA, colour = NA))
d <- d_corrected +
inset_element(d_inset,
left = 0.6, bottom = 0.15, right = 0.9, top = 0.65, align_to = 'full',
ignore_tag = TRUE)
### E
e_z_factor <- read_rds(here('Fig2/subplots/primary_screen_z_factor.rds')) +
scale_color_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
scale_fill_manual(values = c("#FAD510", "#CB2314"), guide = 'none') +
theme(legend.position = 'empty')
### F
f_design <- image_read_pdf((here('Fig2/subplots/Fig2f.pdf')))
f <- ggdraw() + draw_image(f_design)
### G
g_screen <- read_rds(here('Fig2/subplots/primary_screen.rds'))
### H
h_hit_bar <- read_rds(here('Fig2/subplots/hit_bar.rds'))
### I
i_ec <- read_rds(here('Fig2/subplots/ec50_bar.rds'))
# set layout
abc_layout <- c(
area(t = 1, l = 1, b = 8, r = 12),   # a
area(t = 1, l = 13, b = 3, r = 20),  # b
area(t = 4, l = 13, b = 8, r = 20)   # c
)
abc_patch <-
a +
b_frames +
c_celltox +
plot_layout(design = abc_layout)
de_layout <- c(
area(t = 1, l = 1, b = 4, r = 12),   # d
area(t = 1, l = 13, b = 4, r = 20)   # e
)
de_patch <-
d + e_z_factor +
plot_layout(design = de_layout)
# abc_patch / de_patch / f
ghi_layout <- c(
area(t = 1, l = 1, b = 4, r = 14),   # a
area(t = 1, l = 15, b = 2, r = 20),  # b
area(t = 3, l = 15, b = 4, r = 20)   # c
)
ghi_patch <-
g_screen +
h_hit_bar +
i_ec +
plot_layout(design = ghi_layout)
fig2 <- abc_patch / de_patch / f / ghi_patch +
plot_layout(heights = c(0.6, 0.6, 1, 1)) +
plot_annotation(tag_levels = 'a') &
theme(
plot.tag = element_text(size = 12, face = 'bold')
)
save_plot(here('Fig2/Fig2.pdf'),
fig2, base_width = 8.66, base_height = 12)
save_plot(here('Fig2/Fig2.png'),
fig2, base_width = 8.66, base_height = 12)
library(tidyverse)
library(cowplot)
library(patchwork)
library(magick)
library(here)
# Figure 3 ----------------------------------------------------------------
a_motility <- read_rds(here('Fig3/subplots/optimized_motility.rds')) +
theme(
# axis.title.x = element_blank(),
legend.position = 'empty')
b_metabolism <- read_rds(here('Fig3/subplots/heatkilled_metabolism.rds'))
c_fecundity <- read_rds(here('Fig3/subplots/optimized_fecundity.rds')) +
theme(legend.position = 'empty')
d_fecundity <- read_rds(here('Fig3/subplots/baseline_fecundity.rds')) +
theme(legend.position = 'right')
e_fecundity <- read_rds(here('Fig3/subplots/heatkilled_fecundity.rds'))
f_scheme <- image_read_pdf(here('Fig3/subplots/Fig3f.pdf'))
f <- ggdraw() + draw_image(f_scheme)
b_align <- cowplot::align_plots(c_fecundity, e_fecundity,
align = 'h', axis = 'b')
left <- plot_grid(a_motility, b_align[[1]],
align = 'v', axis = 'lr', rel_heights = c(1, 1.1),
nrow = 2, labels = c('a', 'c'), label_size = 12)
right <- plot_grid(b_metabolism, d_fecundity, b_align[[2]],
align = 'v', axis = 'l',
nrow = 3, labels = c('b', 'd', 'e'), label_size = 12, hjust = 0)
top <- plot_grid(left, right,
rel_widths = c(1.25, 1), ncol = 2)
fig3 <- plot_grid(
top, f, rel_heights = c(2.7, 1), nrow = 2, labels = c('', 'f'), label_size = 12)
save_plot(here('Fig3/Fig3.pdf'),
fig3, base_height = 7, base_width = 7)
save_plot(here('Fig3/Fig3.png'),
fig3, base_height = 7, base_width = 7)
library(tidyverse)
library(ggtext)
library(cowplot)
library(magick)
library(patchwork)
library(here)
# Figure 4 ----------------------------------------------------------------
a_motility <- read_rds(here('Fig4/subplots/motility.rds')) +
theme(
axis.title.x = element_blank(),
legend.position = 'empty'
)
b_distinct_lines <- read_rds(here('Fig4/subplots/distinct_lines.rds'))
c_fecundity <- read_rds(here('Fig4/subplots/proportions.rds')) +
theme(
legend.position = 'empty'
)
c_inset <- read_rds(here('Fig4/subplots/baseline.rds')) +
theme(
axis.text.y =  element_markdown(size = 7),
axis.title.y = element_markdown(size = 9),
# axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(fill = 'white', colour = 'black', size = 0.25),
plot.background = element_rect(fill = NA, colour = NA)
)
c <- c_fecundity +
inset_element(c_inset,
left = 0.75, bottom = 0.5, right = 1, top = 1, align_to = 'full', ignore_tag = TRUE)
d_lactate <- read_rds(here('Fig4/subplots/lactate.rds')) +
theme(
legend.position = 'bottom'
)
e_viability <- image_read_pdf(here('Fig4/subplots/Fig4e.pdf'))
e <- ggdraw() + draw_image(e_viability)
legend <- get_legend(d_lactate)
# cowplot -----------------------------------------------------------------
left <- plot_grid(a_motility, c, d_lactate + theme(legend.position = 'empty'), legend,
nrow = 4, align = 'v', axis = 'l', rel_heights = c(1, 0.5, 1, 0.1),
labels = c('a', 'c', 'd'), label_size = 12)
right <- plot_grid(b_distinct_lines, e,
# scale = c(1, 1.05),
nrow = 2, rel_heights = c(1, 0.5),
# align = 'v', axis = 'lr',
labels = c('b', 'e'), label_size = 12)
fig4 <- plot_grid(left, right,
ncol = 2, rel_widths = c(1, 0.5))
save_plot(here('Fig4/Fig4.pdf'),
fig4, base_width = 8.66, base_height = 11)
save_plot(here('Fig4/Fig4.png'),
fig4, base_width = 8.66, base_height = 11)
library(tidyverse)
library(ggtext)
library(cowplot)
library(magick)
library(patchwork)
library(here)
# Figure 6 ----------------------------------------------------------------
cutoff <- -1
a_screen <- read_rds(here('Fig6/subplots/cel_screen_dev.rds')) +
labs(color = '') +
theme(legend.position = 'bottom',
axis.text.x = element_blank(),
axis.title.x = element_blank())
b_followup <- read_rds(here('Fig6/subplots/cel_followup.rds'))  +
scale_fill_manual(values = c("#FAD510", "#CB2314", '#00AFB5'), guide = 'none')
drug_label <- tibble(x = c(3.5, 1.5),
y = 1.7,
label = c('ML 228', 'NAV 2729'),
panel = c('ML 228', 'NAV 2729'))
c_deconvolution <- read_rds(here('Fig6/subplots/deconvolution.rds')) +
geom_text(data = drug_label, aes(x = x, y = y, label = label)) +
labs(fill = '') +
theme(
strip.text.x = element_blank(),
# axis.text.x = element_markdown(angle = 0, hjust = 0.5),
legend.position = 'right'
)
hypoxia <- image_read_pdf(here('Fig6/subplots/hypoxia_reporter.pdf'))
d_hypoxia <- ggdraw() +
draw_image(hypoxia)
e_iron <- read_rds(here('Fig6/subplots/k_s_media.rds'))
# cowplot -----------------------------------------------------------------
legend <- get_legend(a_screen)
(top <- plot_grid(a_screen, b_followup, axis = 't', align = 'h', rel_widths = c(0.85, 1),
labels = c('a', 'b'), label_size = 12))
bottom <- plot_grid(d_hypoxia, e_iron, axis = 't', align = 'h', rel_widths = c(0.65, 1),
labels = c('d', 'e'), label_x = c(0, -0.03), label_size = 12)
fig6 <- plot_grid(top, c_deconvolution, bottom, nrow = 3, labels = c('', 'c', ''),
rel_heights = c(1.15, 0.35, 0.5), label_y = 1.15, label_size = 12)
save_plot(here('Fig6/Fig6.pdf'),
fig6, base_width = 8, base_height = 8)
save_plot(here('Fig6/Fig6.png'),
fig6, base_width = 8, base_height = 8)
cutoff <- -1
a_screen <- read_rds(here('Fig6/subplots/cel_screen_dev.rds')) +
labs(color = '') +
theme(legend.position = 'bottom',
axis.text.x = element_blank(),
axis.title.x = element_blank())
b_followup <- read_rds(here('Fig6/subplots/cel_followup.rds'))  +
scale_fill_manual(values = c("#FAD510", "#CB2314", '#00AFB5'), guide = 'none')
drug_label <- tibble(x = c(3.5, 1.5),
y = 1.7,
label = c('ML 228', 'NAV 2729'),
panel = c('ML 228', 'NAV 2729'))
c_deconvolution <- read_rds(here('Fig6/subplots/deconvolution.rds')) +
geom_text(data = drug_label, aes(x = x, y = y, label = label)) +
labs(fill = '') +
theme(
strip.text.x = element_blank(),
# axis.text.x = element_markdown(angle = 0, hjust = 0.5),
legend.position = 'right'
)
hypoxia <- image_read_pdf(here('Fig6/subplots/hypoxia_reporter.pdf'))
d_hypoxia <- ggdraw() +
draw_image(hypoxia)
e_iron <- read_rds(here('Fig6/subplots/k_s_media.rds'))
legend <- get_legend(a_screen)
(top <- plot_grid(a_screen, b_followup, axis = 't', align = 'h', rel_widths = c(0.85, 1),
labels = c('a', 'b'), label_size = 12))
conflict_prefer("filter", "dplyr")
(top <- plot_grid(a_screen, b_followup, axis = 't', align = 'h', rel_widths = c(0.85, 1),
labels = c('a', 'b'), label_size = 12))
bottom <- plot_grid(d_hypoxia, e_iron, axis = 't', align = 'h', rel_widths = c(0.65, 1),
labels = c('d', 'e'), label_x = c(0, -0.03), label_size = 12)
fig6 <- plot_grid(top, c_deconvolution, bottom, nrow = 3, labels = c('', 'c', ''),
rel_heights = c(1.15, 0.35, 0.5), label_y = 1.15, label_size = 12)
fig6
save_plot(here('Fig6/Fig6.pdf'),
fig6, base_width = 8, base_height = 8)
save_plot(here('Fig6/Fig6.png'),
fig6, base_width = 8, base_height = 8)
library(tidyverse)
library(here)
primary_hits <- read_csv(here("Fig2/tables/Table1.csv")) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
dose_response <- read_rds(here('Fig2/data/ec50.rds')) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
View(dose_response)
cel_hits <- read_rds(here('Fig6/data/cel_hits.rds')) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
secondary_hits <- read_rds(here("Fig4/data//motility_hits.crds") %>%
secondary_hits <- read_rds(here("Fig4/data//motility_hits.rds")) %>%
pivot_wider(id_cols = treatment, names_from = stages, values_from = hit) %>%
mutate(adult_hit_type = case_when(
`Adult female` == "Non-Hit" & `Adult male` == "Non-Hit" ~ "Non-Hit",
`Adult female` == "Hit" & `Adult male` == "Hit" ~ "Both",
`Adult female` == "Hit" ~ "Female",
`Adult male` == "Hit" ~ "Male",
TRUE ~ treatment
)) %>%
select(-contains("male"))
fecundity_proportions <- read_rds(here("Fig4/data/prop_summary.rds")) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
final_table <- left_join(primary_hits, dose_response) %>%
left_join(secondary_hits) %>%
left_join(fecundity_proportions) %>%
left_join(cel_hits) %>%
left_join(links) %>%
relocate(link, .before = treatment) %>%
rename(
fecundity_proportion = mean_prop,
cel_hit = conc
) %>%
filter(treatment != "GNF 5837")
final_table <- left_join(primary_hits, dose_response) %>%
left_join(secondary_hits) %>%
left_join(fecundity_proportions) %>%
left_join(cel_hits) %>%
relocate(link, .before = treatment) %>%
rename(
fecundity_proportion = mean_prop,
cel_hit = conc
) %>%
filter(treatment != "GNF 5837")
final_table <- left_join(primary_hits, dose_response) %>%
left_join(secondary_hits) %>%
left_join(fecundity_proportions) %>%
left_join(cel_hits) %>%
rename(
fecundity_proportion = mean_prop,
cel_hit = conc
) %>%
filter(treatment != "GNF 5837")
View(final_table)
# data wrangling/plotting
library(tidyverse)
library(janitor)
# other plotting
library(cowplot)
library(ggtext)
library(ggbeeswarm)
library(wesanderson)
library(ZamanianLabThemes)
# misc
library(conflicted)
library(here)
# conflict resolution
conflict_prefer("filter", "dplyr")
primary_hits <-
read_csv(here("Fig2/tables/Table1.csv")) %>%
select(number, treatment) %>%
mutate(number = as.character(number))
tidy_data <-
read_rds(here("Fig4/data/lactate_data.rds")) %>%
left_join(primary_hits) %>%
mutate(
assay_date = str_extract(plate, "^20[0-9]{6}"),
number = case_when(
treatment %in% c("Ivermectin", "DMSO") ~ treatment,
!is.na(number) ~ as.character(number),
is.na(number) ~ NA_character_
)
) %>%
drop_na(number) %>%
group_by(stages, treatment) %>%
mutate(worm_number = row_number())
control <- tidy_data %>%
filter(treatment == "DMSO") %>%
group_by(assay_date, stages) %>%
summarise(control_mean = mean(rfu))
# remove the worms that weren't moving at time_point 0
dead <- tribble(
~treatment, ~stages, ~well,
"Ivermectin", "Adult male", "F02",
"PJ 34 hydrochloride", "Adult male", "E06",
"PJ 34 hydrochloride", "Adult male", "G06",
"SSR 146977 hydrochloride", "Adult male", "E07",
"SSR 146977 hydrochloride", "Adult male", "H07",
"Sildenafil citrate", "Adult male", "D01",
"GSK J4", "Adult male", "A06",
"N106", "Adult male", "F01",
"ML 418", "Adult male", "G12",
"Ciclopirox", "Adult male", "G09",
"Sal 003", "Adult female", "B11",
"Sal 003", "Adult female", "C11"
) %>%
mutate(dead = "dead")
lactate_data <- tidy_data %>%
left_join(dead) %>%
filter(is.na(dead)) %>%
select(-dead) %>%
filter(str_detect(plate, "20211017")) %>%
left_join(control) %>%
mutate(rfu_norm = rfu / control_mean) %>%
ungroup() %>%
# hackish way of reordering by group
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate")) %>%
mutate(reorder = str_c(treatment, stages, sep = "_")) %>%
mutate(reorder = fct_reorder(reorder, rfu_norm, mean, .desc = TRUE)) %>%
mutate(
reorder = fct_relevel(reorder, "DMSO_Adult female", "DMSO_Adult male", "Ivermectin_Adult female", "Ivermectin_Adult male")
)
metabolism_hits <- lactate_data %>%
mutate(individual_hit = case_when(
rfu_norm < 0.5 ~ TRUE,
TRUE ~ FALSE
)) %>%
ungroup() %>%
group_by(stages, treatment) %>%
summarise(
treatment_mean = mean(rfu_norm),
n_hit = sum(individual_hit),
n = n()
) %>%
mutate(
hit = case_when(
treatment %in% c("Ivermectin", "DMSO") ~ treatment,
(n_hit > 2) ~ "Hit",
treatment_mean < 0.75 ~ "Hit",
TRUE ~ "Non-Hit"
)
)
(lactate_plot <- lactate_data %>%
left_join(metabolism_hits) %>%
ggplot(aes(x = reorder, y = rfu_norm, group = stages, shape = stages, color = hit, fill = hit)) +
geom_errorbar(
position = position_dodge(width = 1),
stat = "summary", width = 0.5, alpha = 0.75
) +
geom_bar(position = "dodge", stat = "summary", fun = "mean") +
geom_quasirandom(
shape = 21, fill = "white", size = 1,
alpha = 0.75, dodge.width = 0.9, width = 0.1,
show.legend = FALSE
) +
scale_color_manual(
limits = c("Non-Hit", "DMSO", "Ivermectin", "Hit"),
values = c("#273046", "#FAD510", "#CB2314", "#00AFB5")
) +
scale_fill_manual(
limits = c("Non-Hit", "DMSO", "Ivermectin", "Hit"),
values = c("#273046", "#FAD510", "#CB2314", "#00AFB5")
) +
scale_y_continuous(labels = scales::percent, expand = expansion(mult = c(0, 0.05))) +
scale_x_discrete(labels = ~ str_remove(.x, "_.*")) +
facet_wrap(facets = vars(stages), nrow = 2, scales = "free") +
labs(x = "Treatment", y = "Normalized RFU<br>(Percent control)", color = "", fill = "") +
theme_nw2() +
theme(
panel.grid.major.x = element_blank(),
strip.text.x = element_markdown(face = "italic")
) +
NULL)
View(metabolism_hits)
primary_hits <- read_csv(here("Fig2/tables/Table1.csv")) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
dose_response <- read_rds(here('Fig2/data/ec50.rds')) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
cel_hits <- read_rds(here('Fig6/data/cel_hits.rds')) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
motility_hits <- read_rds(here("Fig4/data/motility_hits.rds")) %>%
pivot_wider(id_cols = treatment, names_from = stages, values_from = hit) %>%
mutate(adult_hit_type = case_when(
`Adult female` == "Non-Hit" & `Adult male` == "Non-Hit" ~ "Non-Hit",
`Adult female` == "Hit" & `Adult male` == "Hit" ~ "Both",
`Adult female` == "Hit" ~ "Female",
`Adult male` == "Hit" ~ "Male",
TRUE ~ treatment
)) %>%
select(-contains("male"))
fecundity_hits <- read_rds(here('Fig4/data/fecundity_hits.rds'))
View(fecundity_hits)
fecundity_proportions <- read_rds(here("Fig4/data/prop_summary.rds")) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate"))
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds'))
View(metabolism_hits)
final_table <- left_join(primary_hits, dose_response) %>%
left_join(motility_hits) %>%
left_join(fecundity_proportions) %>%
left_join(cel_hits) %>%
rename(
fecundity_proportion = mean_prop,
cel_hit = conc
) %>%
filter(treatment != "GNF 5837") %>%
rename(Number = number, Compound = treatment, 'Target class' = target_class,
'Primary target' = primary_target, )
View(motility_hits)
motility_hits <- read_rds(here("Fig4/data/motility_hits.rds")) %>%
pivot_wider(id_cols = treatment, names_from = stages, values_from = hit) %>%
mutate(adult_hit_type = case_when(
`Adult female` == "Non-Hit" & `Adult male` == "Non-Hit" ~ "Non-Hit",
`Adult female` == "Hit" & `Adult male` == "Hit" ~ "Both",
`Adult female` == "Hit" ~ "Female",
`Adult male` == "Hit" ~ "Male",
TRUE ~ treatment
)) %>%
select(-contains("male"), motility_hit_type = adult_hit_type)
final_table <- left_join(primary_hits, dose_response) %>%
left_join(motility_hits) %>%
left_join(fecundity_proportions) %>%
left_join(cel_hits) %>%
rename(
fecundity_proportion = mean_prop,
cel_hit = conc
) %>%
filter(treatment != "GNF 5837") %>%
rename(Number = number, Compound = treatment, 'Target class' = target_class,
'Primary target' = primary_target, )
fecundity_hits <- read_rds(here('Fig4/data/fecundity_hits.rds'))
View(fecundity_hits)
View(fecundity_proportions)
fecundity_hits <- read_rds(here('Fig4/data/fecundity_hits.rds')) %>%
select(treatment, fecundity_mean = treatment_mean)
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds')) %>%
select(stages, treatment, metabolism_mean = treatment_mean)
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds'))
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds')) %>%
select(stages, treatment, metabolism_mean = treatment_mean)
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds')) %>%
select(stages, treatment, metabolism_mean = treatment_mean) %>%
pivot_wider(names_from = stages, values_from = metabolism_mean)
metabolism_hits <- read_rds(here('Fig4/data/metabolism_hits.rds')) %>%
select(stages, treatment, metabolism_mean = treatment_mean) %>%
pivot_wider(names_from = stages, values_from = metabolism_mean) %>%
rename('male_metabolism' = 'Adult male', 'female_metabolism' = 'Adult female')
View(cel_hits)
cel_hits <- read_rds(here('Fig6/data/cel_hits.rds')) %>%
mutate(treatment = str_remove(treatment, " hydrochloride| maleate| citrate")) %>%
rename(cel = conc)
final_table <- left_join(primary_hits, dose_response) %>%
left_join(motility_hits) %>%
left_join(fecundity_hits) %>%
left_join(metabolism_hits) %>%
left_join(cel_hits) %>%
filter(treatment != "GNF 5837") %>%
rename(Number = number, Compound = treatment, 'Target class' = target_class,
'Primary target' = primary_target, )
final_table <- left_join(primary_hits, dose_response) %>%
left_join(motility_hits) %>%
left_join(fecundity_hits) %>%
left_join(metabolism_hits) %>%
left_join(cel_hits) %>%
select(-motility_hit_type) %>%
filter(treatment != "GNF 5837") %>%
rename(Number = number, Compound = treatment, 'Target class' = target_class,
'Primary target' = primary_target, 'Primary action' = primary_action,
'Z-motility' = z_motility, 'Z-viability' = z_viability, 'Z-total' = z_total,
'Primary screen hit type' = hit_type, 'EC50 (12 hr. motility)' = motility_12hr, 'EC50 (36 hr. motility)' = motility_36hr,
'EC50 (36 hr. viability)' = viability_36hr, 'Fecundity mean (% control)' = fecundity_mean,
'Female metabolism (% control)' = female_metabolism, 'Male metabolism (% control)' = male_metabolism,
'C. elegans hit (concentration)' = cel)
write_csv(final_table, here('Fig2/tables/Table1_final.csv'))
