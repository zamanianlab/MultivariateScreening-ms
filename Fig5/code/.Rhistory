annotate("segment",
x = 24, xend = 32,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
# geom_richtext(data = tribble(~x, ~y, ~label,
#                              1, -1, 'temp'),
#               aes(x = x, y = y, label = label)) +
scale_x_continuous(limits = c(1, 32), expand = c(0.05, 0.05)) +
theme_void() +
NULL)
heatmaps <- dist_map / pheno_map
join <- ggdraw(heatmaps, xlim = c(0, 1), ylim = c(0, 1.3)) +
draw_plot(dendro, 0.182, 0.98, 0.8, 0.3)
save_plot(here("Fig5/Fig5.pdf"), join, base_height = 8.8, base_width = 6.5)
ggsave(here("Fig5/Fig5.png"), join, height = 8.8, width = 6.5, units = "in", bg = "white")
# write_rds(cluster, 'multivariate/plots/heatmap.rds')
install.packages('stylr')
install.packages('styler')
styler:::style_active_file()
cluster_labels <- tribble(
~x, ~y, ~label,
14, 10, "**↑ Mf EC<sub>50</sub><br>↓ Adult effects**",
10, 19, "**↓ Mf EC<sub>50</sub><br>↓ Adult effects**",
23, 20.5, "**↑ Mf EC<sub>50</sub><br>↑ Adult effects**",
19, 30.5, "**↓ Mf EC<sub>50</sub><br>↑ Adult effects**"
)
# heatmap showing euclidean distances between treatments
(dist_map <- hm %>%
mutate(
dist = case_when(
dist == 0 ~ NA_real_,
TRUE ~ dist
)
) %>%
mutate(
log_dist = log10(dist),
rescale = scales::rescale(dist, to = c(-1, 1))
) %>%
ggplot() +
geom_tile(aes(x = treatment, y = treatment2, fill = rescale)) +
# highlight positive control
annotate(
geom = "rect",
xmin = 0.5, ymin = 19.5,
xmax = 32.5, ymax = 18.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 32.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
# highlight DMSO
annotate(
geom = "rect",
xmin = 0.5, ymin = 5.5,
xmax = 32.5, ymax = 6.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 32.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
# boxes around hits
annotate(
geom = "rect",
xmin = 14.6, ymin = 14.6,
xmax = 18.4, ymax = 18.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 18.6, ymin = 18.6,
xmax = 23.4, ymax = 23.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 23.6, ymin = 23.6,
xmax = 32.4, ymax = 32.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
# box around DMSO-like
annotate(
geom = "rect",
xmin = 0.625, ymin = 0.625,
xmax = 14.4, ymax = 14.4,
color = "black", fill = NA, alpha = 0.5, linetype = "solid", size = 1
) +
geom_richtext(
data = cluster_labels,
aes(x = x, y = y, label = label),
color = "white", fill = alpha("grey30", 0.75),
hjust = 0, size = 8 / 14 * 5
) +
scale_x_discrete(position = "top", labels = labels) +
scale_fill_gradient2(
low = "#ffbf46", high = "grey20", mid = "#575761",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.x = element_text(size = 8, margin = margin(b = 3)),
axis.text.y = element_text(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(7, 0, 2, 7), "pt"),
legend.position = "empty"
) +
NULL)
(pheno_map <- wide %>%
mutate(across(.cols = c("Mf viability", "Mf motility"), ~ scales::rescale(.x, to = c(1, 0)))) %>%
pivot_longer(where(is.numeric), names_to = "phenotype", values_to = "value") %>%
ggplot() +
geom_tile(aes(x = treatment, y = phenotype, fill = value)) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 8.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 8.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
geom_vline(
data = tibble(xintercept = c(14.63, 18.5, 23.5)),
aes(xintercept = xintercept),
color = "#00AFB5", linetype = "solid", size = 1
) +
geom_vline(
xintercept = 14.37,
color = "#273046", linetype = "solid", size = 1
) +
scale_fill_gradient(
low = "#ffbf46", high = "grey20",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.y = element_markdown(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks.y = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(0, 7, 7, 7), "pt"),
legend.position = "empty"
) +
NULL)
(dendro <- ggdendro::ggdendrogram(clust, labels = FALSE) +
annotate("segment",
x = 1, xend = 14,
y = -0.1, yend = -0.1,
colour = "black", size = 2
) +
annotate("segment",
x = 15, xend = 18,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 19, xend = 23,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 24, xend = 32,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
scale_x_continuous(limits = c(1, 32), expand = c(0.05, 0.05)) +
theme_void() +
NULL)
heatmaps <- dist_map / pheno_map
join <- ggdraw(heatmaps, xlim = c(0, 1), ylim = c(0, 1.3)) +
draw_plot(dendro, 0.182, 0.98, 0.8, 0.3)
save_plot(here("Fig5/Fig5.pdf"), join, base_height = 8.8, base_width = 6.5)
ggsave(here("Fig5/Fig5.png"), join, height = 8.8, width = 6.5, units = "in", bg = "white")
cluster_labels <- tribble(
~x, ~y, ~label,
14, 10, "**↑ Mf EC<sub>50</sub><br>↓ Adult effects**",
10, 19, "**↑ Mf EC<sub>50</sub><br>↑ Adult effects**",
23, 20.5, "**↓ Mf EC<sub>50</sub><br>↓ Adult effects**",
19, 30.5, "**↓ Mf EC<sub>50</sub><br>↑ Adult effects**"
)
# heatmap showing euclidean distances between treatments
(dist_map <- hm %>%
mutate(
dist = case_when(
dist == 0 ~ NA_real_,
TRUE ~ dist
)
) %>%
mutate(
log_dist = log10(dist),
rescale = scales::rescale(dist, to = c(-1, 1))
) %>%
ggplot() +
geom_tile(aes(x = treatment, y = treatment2, fill = rescale)) +
# highlight positive control
annotate(
geom = "rect",
xmin = 0.5, ymin = 19.5,
xmax = 32.5, ymax = 18.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 32.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
# highlight DMSO
annotate(
geom = "rect",
xmin = 0.5, ymin = 5.5,
xmax = 32.5, ymax = 6.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 32.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
# boxes around hits
annotate(
geom = "rect",
xmin = 14.6, ymin = 14.6,
xmax = 18.4, ymax = 18.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 18.6, ymin = 18.6,
xmax = 23.4, ymax = 23.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 23.6, ymin = 23.6,
xmax = 32.4, ymax = 32.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
# box around DMSO-like
annotate(
geom = "rect",
xmin = 0.625, ymin = 0.625,
xmax = 14.4, ymax = 14.4,
color = "black", fill = NA, alpha = 0.5, linetype = "solid", size = 1
) +
geom_richtext(
data = cluster_labels,
aes(x = x, y = y, label = label),
color = "white", fill = alpha("grey30", 0.75),
hjust = 0, size = 8 / 14 * 5
) +
scale_x_discrete(position = "top", labels = labels) +
scale_fill_gradient2(
low = "#ffbf46", high = "grey20", mid = "#575761",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.x = element_text(size = 8, margin = margin(b = 3)),
axis.text.y = element_text(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(7, 0, 2, 7), "pt"),
legend.position = "empty"
) +
NULL)
(pheno_map <- wide %>%
mutate(across(.cols = c("Mf viability", "Mf motility"), ~ scales::rescale(.x, to = c(1, 0)))) %>%
pivot_longer(where(is.numeric), names_to = "phenotype", values_to = "value") %>%
ggplot() +
geom_tile(aes(x = treatment, y = phenotype, fill = value)) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 8.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 8.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
geom_vline(
data = tibble(xintercept = c(14.63, 18.5, 23.5)),
aes(xintercept = xintercept),
color = "#00AFB5", linetype = "solid", size = 1
) +
geom_vline(
xintercept = 14.37,
color = "#273046", linetype = "solid", size = 1
) +
scale_fill_gradient(
low = "#ffbf46", high = "grey20",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.y = element_markdown(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks.y = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(0, 7, 7, 7), "pt"),
legend.position = "empty"
) +
NULL)
(dendro <- ggdendro::ggdendrogram(clust, labels = FALSE) +
annotate("segment",
x = 1, xend = 14,
y = -0.1, yend = -0.1,
colour = "black", size = 2
) +
annotate("segment",
x = 15, xend = 18,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 19, xend = 23,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 24, xend = 32,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
scale_x_continuous(limits = c(1, 32), expand = c(0.05, 0.05)) +
theme_void() +
NULL)
heatmaps <- dist_map / pheno_map
join <- ggdraw(heatmaps, xlim = c(0, 1), ylim = c(0, 1.3)) +
draw_plot(dendro, 0.182, 0.98, 0.8, 0.3)
save_plot(here("Fig5/Fig5.pdf"), join, base_height = 8.8, base_width = 6.5)
ggsave(here("Fig5/Fig5.png"), join, height = 8.8, width = 6.5, units = "in", bg = "white")
cluster_labels <- tribble(
~x, ~y, ~label,
14, 10, "**↑ Mf EC<sub>50</sub><br>↓ Adult effects**",
10, 19, "**↓ Mf EC<sub>50</sub><br>↓ Adult effects**",
23, 20.5, "**↑ Mf EC<sub>50</sub><br>↑ Adult effects**",
19, 30.5, "**↓ Mf EC<sub>50</sub><br>↑ Adult effects**"
)
# heatmap showing euclidean distances between treatments
(dist_map <- hm %>%
mutate(
dist = case_when(
dist == 0 ~ NA_real_,
TRUE ~ dist
)
) %>%
mutate(
log_dist = log10(dist),
rescale = scales::rescale(dist, to = c(-1, 1))
) %>%
ggplot() +
geom_tile(aes(x = treatment, y = treatment2, fill = rescale)) +
# highlight positive control
annotate(
geom = "rect",
xmin = 0.5, ymin = 19.5,
xmax = 32.5, ymax = 18.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 32.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
# highlight DMSO
annotate(
geom = "rect",
xmin = 0.5, ymin = 5.5,
xmax = 32.5, ymax = 6.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 32.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
# boxes around hits
annotate(
geom = "rect",
xmin = 14.6, ymin = 14.6,
xmax = 18.4, ymax = 18.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 18.6, ymin = 18.6,
xmax = 23.4, ymax = 23.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
annotate(
geom = "rect",
xmin = 23.6, ymin = 23.6,
xmax = 32.4, ymax = 32.4,
color = "#00AFB5", fill = NA, linetype = "solid", size = 1
) +
# box around DMSO-like
annotate(
geom = "rect",
xmin = 0.625, ymin = 0.625,
xmax = 14.4, ymax = 14.4,
color = "black", fill = NA, alpha = 0.5, linetype = "solid", size = 1
) +
geom_richtext(
data = cluster_labels,
aes(x = x, y = y, label = label),
color = "white", fill = alpha("grey30", 0.75),
hjust = 0, size = 8 / 14 * 5
) +
scale_x_discrete(position = "top", labels = labels) +
scale_fill_gradient2(
low = "#ffbf46", high = "grey20", mid = "#575761",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.x = element_text(size = 8, margin = margin(b = 3)),
axis.text.y = element_text(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(7, 0, 2, 7), "pt"),
legend.position = "empty"
) +
NULL)
(pheno_map <- wide %>%
mutate(across(.cols = c("Mf viability", "Mf motility"), ~ scales::rescale(.x, to = c(1, 0)))) %>%
pivot_longer(where(is.numeric), names_to = "phenotype", values_to = "value") %>%
ggplot() +
geom_tile(aes(x = treatment, y = phenotype, fill = value)) +
annotate(
geom = "rect",
xmin = 5.5, ymin = 0.5,
xmax = 6.5, ymax = 8.5,
color = NA, fill = "#FAD510", alpha = 0.5
) +
annotate(
geom = "rect",
xmin = 18.5, ymin = 0.5,
xmax = 19.5, ymax = 8.5,
color = NA, fill = "#CB2314", alpha = 0.5
) +
geom_vline(
data = tibble(xintercept = c(14.63, 18.5, 23.5)),
aes(xintercept = xintercept),
color = "#00AFB5", linetype = "solid", size = 1
) +
geom_vline(
xintercept = 14.37,
color = "#273046", linetype = "solid", size = 1
) +
scale_fill_gradient(
low = "#ffbf46", high = "grey20",
na.value = "black"
) +
coord_fixed() +
theme_void() +
theme(
axis.text.y = element_markdown(size = 8, hjust = 1, margin = margin(r = 3)),
axis.ticks.y = element_line(size = 0.25, linetype = "solid"),
axis.ticks.length = unit(3, "pt"),
plot.margin = unit(c(0, 7, 7, 7), "pt"),
legend.position = "empty"
) +
NULL)
(dendro <- ggdendro::ggdendrogram(clust, labels = FALSE) +
annotate("segment",
x = 1, xend = 14,
y = -0.1, yend = -0.1,
colour = "black", size = 2
) +
annotate("segment",
x = 15, xend = 18,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 19, xend = 23,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
annotate("segment",
x = 24, xend = 32,
y = -0.1, yend = -0.1,
colour = "#00AFB5", size = 2
) +
scale_x_continuous(limits = c(1, 32), expand = c(0.05, 0.05)) +
theme_void() +
NULL)
heatmaps <- dist_map / pheno_map
join <- ggdraw(heatmaps, xlim = c(0, 1), ylim = c(0, 1.3)) +
draw_plot(dendro, 0.182, 0.98, 0.8, 0.3)
save_plot(here("Fig5/Fig5.pdf"), join, base_height = 8.8, base_width = 6.5)
ggsave(here("Fig5/Fig5.png"), join, height = 8.8, width = 6.5, units = "in", bg = "white")
